import zipfile
import os
import filetype  # pip install filetype

docx_path = "J187_01_eSL_YONO_2.0_Lock_Web (1) (1).docx"

if zipfile.is_zipfile(docx_path):
    with zipfile.ZipFile(docx_path, 'r') as docx:
        file_list = docx.namelist()
        embedded_files = [f for f in file_list if f.startswith('word/embeddings/')]

        if embedded_files:
            print(f"üß© Found {len(embedded_files)} embedded files:\n")
            for i, emb in enumerate(embedded_files, 1):
                data = docx.read(emb)
                temp_name = f"embedded_{i}.bin"
                
                # Save the binary temporarily
                with open(temp_name, "wb") as f:
                    f.write(data)

                # Identify the file type
                kind = filetype.guess(temp_name)
                if kind:
                    print(f"{emb} ‚Üí Detected: {kind.mime}  |  Extension: .{kind.extension}")
                    
                    # Rename to correct extension for easier inspection
                    new_name = f"embedded_{i}.{kind.extension}"
                    os.rename(temp_name, new_name)
                    print(f"‚úÖ Extracted as {new_name}\n")
                else:
                    print(f"{emb} ‚Üí ‚ùì Unknown file type (possibly encrypted or unsupported)\n")
        else:
            print("‚ùå No embedded files found in this document.")
else:
    print("Not a valid DOCX file.")






           



import zipfile
import os
import filetype  # pip install filetype

def extract_embedded_files(docx_path, output_folder, level=0):
    """Recursively extract and identify embedded files from a DOCX."""
    indent = "  " * level
    if not zipfile.is_zipfile(docx_path):
        return

    with zipfile.ZipFile(docx_path, 'r') as docx:
        file_list = docx.namelist()
        embedded_files = [f for f in file_list if f.startswith('word/embeddings/')]

        if embedded_files:
            print(f"{indent}üß© Found {len(embedded_files)} embedded file(s) in {os.path.basename(docx_path)}")

            for i, emb in enumerate(embedded_files, 1):
                data = docx.read(emb)
                temp_name = f"{os.path.splitext(os.path.basename(docx_path))[0]}_embedded_{i}.bin"
                temp_path = os.path.join(output_folder, temp_name)

                with open(temp_path, "wb") as f:
                    f.write(data)

                kind = filetype.guess(temp_path)
                if kind:
                    new_name = f"{os.path.splitext(temp_name)[0]}.{kind.extension}"
                    new_path = os.path.join(output_folder, new_name)
                    os.rename(temp_path, new_path)
                    print(f"{indent}‚Üí {emb} detected as {kind.mime}, saved as {new_name}")

                    # If it‚Äôs another DOCX, scan it recursively
                    if kind.extension == "docx":
                        extract_embedded_files(new_path, output_folder, level + 1)
                else:
                    print(f"{indent}‚Üí {emb} unknown type (kept as .bin)")
        else:
            print(f"{indent}No embedded files found in {os.path.basename(docx_path)}")


# ===== MAIN EXECUTION =====
main_docx = "J187_01_eSL_YONO_2.0_Lock_Web (1) (1).docx"
output_dir = "extracted_files"
os.makedirs(output_dir, exist_ok=True)

extract_embedded_files(main_docx, output_dir)

print(f"\n‚úÖ Extraction complete. All files saved to: {os.path.abspath(output_dir)}")