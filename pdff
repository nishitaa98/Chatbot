import zipfile
import os
import filetype  # pip install filetype

docx_path = "J187_01_eSL_YONO_2.0_Lock_Web (1) (1).docx"

if zipfile.is_zipfile(docx_path):
    with zipfile.ZipFile(docx_path, 'r') as docx:
        file_list = docx.namelist()
        embedded_files = [f for f in file_list if f.startswith('word/embeddings/')]

        if embedded_files:
            print(f"üß© Found {len(embedded_files)} embedded files:\n")
            for i, emb in enumerate(embedded_files, 1):
                data = docx.read(emb)
                temp_name = f"embedded_{i}.bin"
                
                # Save the binary temporarily
                with open(temp_name, "wb") as f:
                    f.write(data)

                # Identify the file type
                kind = filetype.guess(temp_name)
                if kind:
                    print(f"{emb} ‚Üí Detected: {kind.mime}  |  Extension: .{kind.extension}")
                    
                    # Rename to correct extension for easier inspection
                    new_name = f"embedded_{i}.{kind.extension}"
                    os.rename(temp_name, new_name)
                    print(f"‚úÖ Extracted as {new_name}\n")
                else:
                    print(f"{emb} ‚Üí ‚ùì Unknown file type (possibly encrypted or unsupported)\n")
        else:
            print("‚ùå No embedded files found in this document.")
else:
    print("Not a valid DOCX file.")



import zipfile
import os
import filetype
import olefile  # pip install olefile

docx_path = "J187_01_eSL_YONO_2.0_Lock_Web (1) (1).docx"
output_folder = "extracted_files"
os.makedirs(output_folder, exist_ok=True)

def extract_ole_object(ole_path, output_folder, prefix="embedded"):
    """Extracts the real file inside an OLE .bin file if present."""
    try:
        if not olefile.isOleFile(ole_path):
            return None

        ole = olefile.OleFileIO(ole_path)
        for stream_name in ole.listdir():
            # Usually the actual file content is stored under '\x01Ole10Native'
            if "Ole10Native" in stream_name:
                data = ole.openstream(stream_name).read()
                # Extract the embedded filename and content
                # Format: [original name]\0[unknown]\0[file path]\0[content]
                parts = data.split(b'\x00')
                if len(parts) > 3:
                    original_name = parts[0].decode(errors='ignore')
                    file_data = parts[-1]
                    output_file = os.path.join(output_folder, f"{prefix}_{original_name}")
                    with open(output_file, "wb") as out:
                        out.write(file_data)
                    print(f"‚úÖ Extracted actual file: {original_name}")
                    return output_file
        ole.close()
    except Exception as e:
        print(f"‚ö†Ô∏è Error reading OLE: {e}")
    return None


if zipfile.is_zipfile(docx_path):
    with zipfile.ZipFile(docx_path, 'r') as docx:
        embedded_files = [f for f in docx.namelist() if f.startswith("word/embeddings/")]

        if embedded_files:
            print(f"üß© Found {len(embedded_files)} embedded files:\n")
            for i, emb in enumerate(embedded_files, 1):
                data = docx.read(emb)
                temp_bin = os.path.join(output_folder, f"embedded_{i}.bin")
                with open(temp_bin, "wb") as f:
                    f.write(data)

                # Try OLE extraction
                real_file = extract_ole_object(temp_bin, output_folder, prefix=f"embedded_{i}")

                if not real_file:
                    # Fallback: Try to detect normally
                    kind = filetype.guess(temp_bin)
                    if kind:
                        new_name = os.path.join(output_folder, f"embedded_{i}.{kind.extension}")
                        os.rename(temp_bin, new_name)
                        print(f"{emb} ‚Üí Detected {kind.mime} | Saved as {new_name}")
                    else:
                        print(f"{emb} ‚Üí ‚ùì Unknown or icon object (kept as .bin)")
                else:
                    os.remove(temp_bin)

            print(f"\n‚úÖ All extracted content saved to: {os.path.abspath(output_folder)}")
        else:
            print("‚ùå No embedded files found.")
else:
    print("‚ö†Ô∏è Not a valid DOCX file.")


           


